<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer Guide • tidyCDISC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Developer Guide">
<meta property="og:description" content="tidyCDISC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyCDISC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidyCDISC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Blog.html">Blog Posts</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">User Guides</li>
    <li>
      <a href="../articles/x00_Data_Upload.html">00 Data Upload</a>
    </li>
    <li>
      <a href="../articles/x01_Table_Generator.html">01 Table Generator</a>
    </li>
    <li>
      <a href="../articles/x02_Pop_Exp.html">02 Population Explorer</a>
    </li>
    <li>
      <a href="../articles/x03_Indv_Expl.html">03 Individual Explorer</a>
    </li>
    <li>
      <a href="../articles/x04_Filtering.html">04 Filtering</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Biogen-Inc/tidyCDISC/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="developer_guide_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Developer Guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Biogen-Inc/tidyCDISC/blob/master/vignettes/developer_guide.Rmd"><code>vignettes/developer_guide.Rmd</code></a></small>
      <div class="hidden name"><code>developer_guide.Rmd</code></div>

    </div>

    
    
<div id="table-generator" class="section level1">
<h1 class="hasAnchor">
<a href="#table-generator" class="anchor"></a>Table Generator</h1>
<p>Learn how to contribute useful code to the table generator tab, by topic.</p>
<div id="create-a-statistical-block" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-statistical-block" class="anchor"></a>Create A Statistical Block</h2>
<p>This tutorial will walk you through creating a new statistical block for the Table Generator using JavaScript and R, then writing an R function to use the block within the <code>gt</code> table.</p>
<div id="create-the-drag-zone-block" class="section level3">
<h3 class="hasAnchor">
<a href="#create-the-drag-zone-block" class="anchor"></a>Create the Drag Zone Block</h3>
<p>Within <code>R/mod_TableGen_ui</code> you’ll find a list of blocks.</p>
<p>If you are going to create a simple block like in the case of <code>MEAN</code>, you’ll give the block an id in lowercase, and a label to be displayed in uppercase. You must also give the block <code>class = agg</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"mean"</span>,<span class="st">"MEAN"</span>,class <span class="op">=</span> <span class="st">"agg"</span><span class="op">)</span></code></pre></div>
<p>If you want to create a more complicated block that changes within the drop zone, or has hover text there are a couple more arguments you must add:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"ui-state-default agg"</span>, id <span class="op">=</span> <span class="st">"chg"</span>,
        <span class="fu">div</span><span class="op">(</span><span class="fu">tippy</span><span class="op">(</span><span class="fu">div</span><span class="op">(</span><span class="st">"CHG"</span><span class="op">)</span>, <span class="st">"Change from Baseline"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>an additional <code>ui-state-default</code> class</li>
<li>another div using the package <code>tippy</code> to create the text to display <code>CHG</code> and the hover text</li>
</ul>
</div>
<div id="create-the-drop-zone-block" class="section level3">
<h3 class="hasAnchor">
<a href="#create-the-drop-zone-block" class="anchor"></a>Create the Drop Zone Block</h3>
<p>Under <code>www/inst</code> you will find the <code>script.js</code> file which describes the HTML for a block within the drag zone.</p>
<p>Currently there are two JavaScript functions to create HTML blocks</p>
<ul>
<li><p><code>simpleBlock</code> which creates a block like the <code>FREQ</code> block which says “FREQ” when dragged and has a delete button</p></li>
<li><p><code>selectWeekBlock</code> which creates a dropdown when the block is dragged into the drop zone, determined by the unique values in the <code>AVISIT</code> column</p></li>
</ul>
<p>You can add your block to the function <code>$("#droppable_agg").droppable(...</code> like so:</p>
<pre><code>} else if (draggableId.includes("mean")) {
    $(this).append(selectWeekBlock(newid, "MEAN", select));
}</code></pre>
<p>Where the lowecase <code>mean</code> corresponds to the ID of the block, and <code>new_id</code> is a JavaScript function that appends a number to your block ID in case there are multiple <code>mean</code> blocks inside the dropzone. The uppercase <code>MEAN</code> is what you want your block to display. Similarly you can change this code from <code>selectWeekBlock</code> to a simple block if you don’t need the week dropdown.</p>
</div>
<div id="writing-the-function" class="section level3">
<h3 class="hasAnchor">
<a href="#writing-the-function" class="anchor"></a>Writing the function</h3>
<p>When you drag a column block, the shiny input returns the name of the column and the data file it came from. Using the <code>custom_class</code> function, the column name is given a class of <code>BDS</code>, <code>ADSL</code>, or <code>OCCDS</code></p>
<p>We can leverage these classes when creating a new statistical function because we may want to perform slightly different calculations on an ADSL or BDS, for instance.</p>
<p>Let’s look at <code>mod_tableGen_fct_freq</code> as an example:</p>
</div>
<div id="create-a-function" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-function" class="anchor"></a>Create a function</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app_freq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html">UseMethod</a></span><span class="op">(</span><span class="st">"app_freq"</span>, <span class="va">column</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">app_freq.default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span>
    <span class="st">"Can't calculate mean because data is not classified as ADLB, BDS or OCCDS"</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="create-a-method-for-adsl" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-method-for-adsl" class="anchor"></a>Create a method for ADSL</h3>
<p>In the case of ADSL we need to calculate the frequency for the entire table, or if groups are selected and return a table of values to be used in gt.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app_freq.ADSL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">column</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">column</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Can't calculate frequency, "</span>, <span class="va">column</span>, <span class="st">" is not categorical"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">data</span> <span class="op">%&gt;%</span>
      <span class="fu">distinct</span><span class="op">(</span><span class="va">USUBJID</span>, <span class="op">!</span><span class="op">!</span><span class="va">column</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">count</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">column</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">group_by</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">column</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">n</span>, <span class="st">" ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">prop</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">select</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">column</span>, <span class="va">x</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    
    <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="va">column</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"Cannot calculate frequency for {column} when also set as group."</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    
    <span class="va">group</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>
    <span class="va">data</span> <span class="op">%&gt;%</span>
      <span class="fu">distinct</span><span class="op">(</span><span class="va">USUBJID</span>, <span class="op">!</span><span class="op">!</span><span class="va">column</span>, <span class="op">!</span><span class="op">!</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">count</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">column</span>, <span class="op">!</span><span class="op">!</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">group_by</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>v1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">n</span>, <span class="st">' ('</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">prop</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">')'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">n</span>, <span class="op">-</span><span class="va">prop</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu">spread</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">group</span>, <span class="va">v1</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="create-a-method-for-bds" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-method-for-bds" class="anchor"></a>Create a method for BDS</h3>
<p>We don’t need a method for BDS because we currently only import PARAMCD blocks and since AVAL and CHG are numeric we can’t calculate frequency:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app_freq.BDS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span>
    <span class="st">"Can't calculate frequency for BDS - {column} is numeric"</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Feel free to explore the mean, ANOVA, and chg files for other statistical examples. For instance, blocks with BDS methods use the <code>week</code> argument which is supplied from the block’s dropdown.</p>
</div>
</div>
<div id="putting-it-all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together" class="anchor"></a>Putting it all together</h2>
<p>Once you have your statistical function, you need to add it to the <code>app_methods</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app_methods</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">agg</span>, <span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">agg</span> <span class="op">==</span> <span class="st">"MEAN"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/app_mean.html">app_mean</a></span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">agg</span> <span class="op">==</span> <span class="st">"FREQ"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/app_freq.html">app_freq</a></span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">agg</span> <span class="op">==</span> <span class="st">"ANOVA"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/app_anova.html">app_anova</a></span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/app_chg.html">app_chg</a></span><span class="op">(</span><span class="va">column</span>, <span class="va">week</span>, <span class="va">group</span>, <span class="va">data</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>This function will look for the name of the dragged in statistical block and apply the correct statistical function based on the block’s name. Since the first argument of the function is the column to apply the statistical block on, it will look for the data file the column came from and choose the correct method.</p>
<p>Finally this function is used within a <code>map</code> in <code>mod_tableGen</code> so each statistical block is applied to each column in the drop zone iteratively.</p>
<p><br><br></p>
<hr>
<p><br><br><br><br></p>
</div>
</div>
<div id="population-explorer" class="section level1">
<h1 class="hasAnchor">
<a href="#population-explorer" class="anchor"></a>Population Explorer</h1>
<p>Learn how to contribute useful code to the population explorer tab, by topic.</p>
<div id="add-a-graph-to-the-population-explorer" class="section level2">
<h2 class="hasAnchor">
<a href="#add-a-graph-to-the-population-explorer" class="anchor"></a>Add a Graph to the Population Explorer</h2>
<p>We plot points, but we graph functions.</p>
<p>Adding a new graph to the population explorer is a four-step process:</p>
<ul>
<li>Create the plotting widgets</li>
<li>Create the plotting output</li>
<li>Connect the plot to the Population Explorer Module</li>
<li>Testing</li>
</ul>
<p>Each plot in the Population Explorer is a submodule <code>mod_popExp_&lt;newgraph&gt;.R</code> (where <newgraph> is the plot name to be added) that is conditionally called within <code>mod_popExp.R</code> and <code>mod_popExp_ui.R</code>. The plotting module is used for the reactivity logic of the plot; the widgets needed as well as how to render them. The plot function itself is found within <code>mod_popExp_fct_&lt;newgraph&gt;.R</code></newgraph></p>
<p>This tutorial will walk you through adding a graph module and a graph function, then applying it to the Population Explorer module using <code>mod_popExp_boxplot.R</code> and <code>mod_popExp_fct_boxplot.R</code> as examples. This is what the population explorer looked like when it first launched. Note we are using a small (N=15) test ADSL dataset here:</p>
<p><img src="figures/popExp/boxplot%20tidyCDISC.PNG" width="90%" height="90%"></p>
<div id="create-the-plotting-widgets-ui" class="section level3">
<h3 class="hasAnchor">
<a href="#create-the-plotting-widgets-ui" class="anchor"></a>Create the Plotting Widgets (“ui”)</h3>
<p>Inside <code>mod_popExp_boxplot.R</code>, <code>boxPlot_ui</code> is where we specify the widgets we need to create a boxplot, all wrapped inside a <code>wellPanel</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boxPlot_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">label</span> <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu">NS</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>
  <span class="fu">tagList</span><span class="op">(</span>
    <span class="fu">h4</span><span class="op">(</span><span class="st">"Select axes:"</span><span class="op">)</span>,
    <span class="fu">wellPanel</span><span class="op">(</span>
      <span class="fu">selectInput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"yvar"</span><span class="op">)</span>, <span class="st">"Select y-axis"</span>, choices <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
      <span class="fu">fluidRow</span><span class="op">(</span><span class="fu">column</span><span class="op">(</span><span class="fl">12</span>, align <span class="op">=</span> <span class="st">"center"</span>, <span class="fu">uiOutput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"include_var"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
      <span class="fu">selectInput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>, <span class="st">"Group By"</span>, choices <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
      <span class="fu">checkboxInput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"points"</span><span class="op">)</span>, <span class="st">"Add Points?"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Note that this has two selectInput widgets, a fluidRow, and a checkboxInput widget.<br> Customize this to whatever widgets your graph requires.</p>
</div>
<div id="create-the-plotting-output-server" class="section level3">
<h3 class="hasAnchor">
<a href="#create-the-plotting-output-server" class="anchor"></a>Create the Plotting Output (“server”)</h3>
<p>The bulk of the server function, <code>boxPlot_srv</code> uses <code>updateSelectInput</code>s to populate the dropdown fields of the widget based on the module’s data argument. The data is a reactive that is passed down from the parent module. The boxplot itself is created using the function <code><a href="../reference/app_boxplot.html">app_boxplot()</a></code>, located in <code>mod_popExp_fct_boxplot.R</code>. This function takes on the selected inputs from the widget.</p>
<p>Here is the code for <code>mod_popExp_fct_boxplot.R</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' tidyCDISC boxplot</span>
<span class="co">#' </span>
<span class="co">#' Create boxplot using either the selected response variable</span>
<span class="co">#' or if a PARAMCD is selected, then plot the corresponding value</span>
<span class="co">#' and filter the data by week</span>
<span class="co">#' </span>
<span class="co">#' @param data Merged data to be used in plot</span>
<span class="co">#' @param yvar Selected y-axis </span>
<span class="co">#' @param group Selected x-axis </span>
<span class="co">#' @param value If yvar is a PARAMCD then the user must select </span>
<span class="co">#' AVAL, CHG, or BASE to be plotted on the y-axis</span>
<span class="co">#' @param points \code{logical} whether to add a jitter to the plot</span>
<span class="co">#' </span>
<span class="co">#' @family popExp Functions</span>

<span class="va">app_boxplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">yvar</span>, <span class="va">group</span>, <span class="va">value</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">points</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">yvar</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">yvar</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">yvar</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">var_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">yvar</span><span class="op">]</span><span class="op">]</span>, <span class="st">'label'</span><span class="op">)</span>, <span class="st">"by"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span>
    
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span> <span class="va">yvar</span><span class="op">)</span>
    
    <span class="va">var_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">PARAM</span><span class="op">)</span><span class="op">)</span>
    <span class="va">var_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">var_label</span>, <span class="st">"by"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{var_label} ({attr(data[[value]], 'label')})"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
                   axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
                   plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">var_title</span><span class="op">)</span>
  
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">points</span><span class="op">)</span> <span class="op">{</span> <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="connect-the-plot-to-the-population-explorer-module" class="section level3">
<h3 class="hasAnchor">
<a href="#connect-the-plot-to-the-population-explorer-module" class="anchor"></a>Connect the plot to the Population Explorer Module</h3>
<div id="connect-to-ui" class="section level4">
<h4 class="hasAnchor">
<a href="#connect-to-ui" class="anchor"></a>Connect to ui</h4>
<p>Inside <code>mod_popExp_ui</code>, the radioButtons <code>plot_type</code> control which plot widgets and plot output the user sees. Therefore the first step is to add your graph name to the types of graphs we can create:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">radioButtons</span>(<span class="fu">ns</span>(<span class="st">"plot_type"</span>), <span class="cn">NULL</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Scatter Plot"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Spaghetti Plot"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Box Plot"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"&lt;newgraph&gt;"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                  <span class="er">)</span></span></code></pre></div>
<p>Next we use <code>conditionalPanel</code> statements to show the correct inputs based on which plot the user selects. When the <code>input.plot_type</code> is <code>Box Plot</code> the <code>boxPlot_ui</code> function is called and the “boxPlot” name space is added so that the inputs all have a prefix of both the Population Explorer module and the Box Plot module. Do the same for your new graph.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#wellPanel(uiOutput(ns("plot_ui")))</span>
<span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"pop_cic_chart_inputs"</span>, 
    <span class="fu">conditionalPanel</span><span class="op">(</span><span class="st">"input.plot_type === 'Scatter Plot'"</span>, ns <span class="op">=</span> <span class="va">ns</span>, <span class="fu">scatterPlot_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"scatterPlot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu">conditionalPanel</span><span class="op">(</span><span class="st">"input.plot_type === 'Spaghetti Plot'"</span>, ns <span class="op">=</span> <span class="va">ns</span>, <span class="fu">spaghettiPlot_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"spaghettiPlot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu">conditionalPanel</span><span class="op">(</span><span class="st">"input.plot_type === 'Box Plot'"</span>, ns <span class="op">=</span> <span class="va">ns</span>, <span class="fu">boxPlot_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"boxPlot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu">conditionalPanel</span><span class="op">(</span><span class="st">"input.plot_type === '&lt;newgraph&gt;'"</span>, ns <span class="op">=</span> <span class="va">ns</span>, <span class="fu">boxPlot_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"&lt;newgraph&gt;"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
             <span class="op">)</span></code></pre></div>
</div>
<div id="connect-to-server" class="section level4">
<h4 class="hasAnchor">
<a href="#connect-to-server" class="anchor"></a>Connect to Server</h4>
<p>On the server side we save the output of the box plot server function to an object, <code>p_box</code>. Note that this module takes on a data argument. The user input files are properly merged and this merged dataset is what we pass to the child plot modules. Do the same for your new graph.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>  p_scatter <span class="ot">&lt;-</span> <span class="fu">callModule</span>(scatterPlot_srv, <span class="st">"scatterPlot"</span>, <span class="at">data =</span> dataset)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  p_spaghetti <span class="ot">&lt;-</span> <span class="fu">callModule</span>(spaghettiPlot_srv, <span class="st">"spaghettiPlot"</span>, <span class="at">data =</span> dataset)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  p_box <span class="ot">&lt;-</span> <span class="fu">callModule</span>(boxPlot_srv, <span class="st">"boxPlot"</span>, <span class="at">data =</span> dataset)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  p_<span class="sc">&lt;</span>newgraph<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> <span class="fu">callModule</span>(boxPlot_srv, <span class="st">"&lt;newgraph&gt;"</span>, <span class="at">data =</span> dataset)</span></code></pre></div>
<p>Now that we have our module outputs, we can pass the graph object to Population Explorers plot_output. Don’t forget to add the reactive callModule statement for your graph. This takes on a switch statement where we render the module object based on which plot is selected.</p>
<p>Note that the plot types are surrounded by back-ticks, not single quotes. On American keyboards, the back-tick resides on the same key as the tilde (“~”). Be sure your naming conventions are consistent. Don’t use lowerCamelCase for your graph name in one place and UpperCamelCase in another.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use plot output of the module to create the plot </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span>(input<span class="sc">$</span>plot_type,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Scatter Plot</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">p_scatter</span>(),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Box Plot</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">p_box</span>(),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Spaghetti Plot</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">p_spaghetti</span>(),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">&lt;newgraph&gt;</span><span class="st">`</span> <span class="ot">=</span> p_<span class="sc">&lt;</span>newgraph<span class="sc">&gt;</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
</div>
</div>
<div id="testing" class="section level3">
<h3 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h3>
<p>A file called <code>test-popExp_fct_boxplot.R</code> is created to test that the plot function inside <code>mod_popExp_fct_boxplot</code> generates the expected output given various inputs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span>
<span class="fu"><a href="https://testthat.r-lib.org/reference/context.html">context</a></span><span class="op">(</span><span class="st">"Create popExp Boxplot"</span><span class="op">)</span>

<span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"numeric response variable works"</span>, <span class="op">{</span>
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/app_boxplot.html">app_boxplot</a></span><span class="op">(</span><span class="va">tg_data</span>, <span class="st">"AGE"</span>, <span class="st">"SEX"</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">quo_get_expr</span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu">sym</span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">quo_get_expr</span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu">sym</span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"PARAMCD response variable works"</span>, <span class="op">{</span>
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/app_boxplot.html">app_boxplot</a></span><span class="op">(</span><span class="va">tg_data</span>, <span class="st">"DIABP"</span>, <span class="st">"SEX"</span>, value <span class="op">=</span> <span class="st">"AVAL"</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">quo_get_expr</span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu">sym</span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">quo_get_expr</span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu">sym</span><span class="op">(</span><span class="st">"AVAL"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"adding jitter works"</span>, <span class="op">{</span>
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/app_boxplot.html">app_boxplot</a></span><span class="op">(</span><span class="va">tg_data</span>, <span class="st">"AGE"</span>, <span class="st">"SEX"</span>, points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="st">"PositionJitter"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">layers</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">position</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>You will need to develop similar tests for you graph. Review the <code><a href="https://testthat.r-lib.org/reference/testthat-package.html">testthat()</a></code> package first.</p>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Here is what the population explorer looks like after adding a Histogram to it. This is using the same small ADSL dataset as above.</p>
<p><img src="figures/popExp/Histogram.png" width="90%" height="90%"></p>
<p><br><br></p>
<hr>
<p><br><br><br><br></p>
</div>
</div>
<div id="individual-explorer" class="section level1">
<h1 class="hasAnchor">
<a href="#individual-explorer" class="anchor"></a>Individual Explorer</h1>
<p>Learn how to contribute useful code to the individual explorer tab, by topic.</p>
<div id="integrate-new-events-in-individual-explorer" class="section level2">
<h2 class="hasAnchor">
<a href="#integrate-new-events-in-individual-explorer" class="anchor"></a>Integrate New Events in Individual Explorer</h2>
<p>This tutorial will walk you through how to add / display additional events on the Individual Explorer Tab. Currently, the app supports events from ADMH, ADAE, ADCM, ADSL, ADLB, and ADLBC. You’ll note that most are occurrence (OCCD) class data sets which are designed to be date-oriented with the exception of ADSL, ADLB, &amp; ADLBC. Regardless of data set class, the events tab’s module extracts important dates that you (the developer) chooses from any data set for display.</p>
<p>When incorporating a new date / data set into the events module you’ll not only need to consider additional UI elements, but there are two R functions to become familiar with which are introduced below.</p>
<div id="ui-considerations" class="section level3">
<h3 class="hasAnchor">
<a href="#ui-considerations" class="anchor"></a>UI considerations</h3>
<p>In <code>mod_indvExp_ui.R</code>, the input called “checkGroup” &amp; “overlay_events” are introduced to the app’s user interface. The former is for the <code>Events</code> tab and the latter is for the <code>Visits</code> tab.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Events Tab</span>
<span class="fu">checkboxGroupInput</span><span class="op">(</span>
  inputId <span class="op">=</span> <span class="fu">ns</span><span class="op">(</span><span class="st">"checkGroup"</span><span class="op">)</span>,
  label <span class="op">=</span> <span class="st">"For additional patient events, load an AE, LB, LBC, CM, or MH"</span>,
  choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">" "</span><span class="op">)</span>,
  selected <span class="op">=</span> <span class="cn">NULL</span>,
  inline <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visits Tab</span>
<span class="fu">checkboxGroupInput</span><span class="op">(</span>
  <span class="fu">ns</span><span class="op">(</span><span class="st">"overlay_events"</span><span class="op">)</span>,
  label <span class="op">=</span> <span class="fu">HTML</span><span class="op">(</span><span class="st">"&lt;br/&gt;Overlay Events:"</span><span class="op">)</span>,
  choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">" "</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Later, these values will get populated with server side logic that depends on what the ADaMs the user uploads &amp; the USUBJID selected. That logic can be found in <code>mod_indvExpPat.R</code> and a snapshot is shown below. To summarize, the code checks if a supported ADaM exists, and if it does, that ADaM is assigned an domain abbreviation to be fed to the <code>choices</code> argument for our two inputs: checkGroup and overlay_events. Notice how overlay_events only receives a subset of these choices, because Labs and Medical History aren’t terribly valuable vertical lines to overlay on the <code>Visits</code> tab.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># update checkboxes on both Events and Visits Tabs</span>
<span class="co"># Initialize</span>
<span class="va">checked1</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">checked2</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">checked3</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">checked4</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">checked5</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">mh_names</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co"># check for "adsl" (required), "adae", "adcm", and "adlb"</span>
<span class="kw">if</span> <span class="op">(</span><span class="st">"ADSL"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">checked1</span> <span class="op">&lt;-</span> <span class="st">"DS"</span> <span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="st">"ADAE"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">checked2</span> <span class="op">&lt;-</span> <span class="st">"AE"</span> <span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="st">"ADCM"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">checked3</span> <span class="op">&lt;-</span> <span class="st">"CM"</span> <span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="st">"ADLB"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">checked4</span> <span class="op">&lt;-</span> <span class="st">"LB"</span> <span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="st">"ADMH"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># For ADMH, we want to create separate checkboxes for each type of </span>
  <span class="co"># Medical History Category that exist in the ADMH for the selected patient.</span>
  <span class="va">mh_names</span> <span class="op">&lt;-</span>
    <span class="fu">datafile</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"ADMH"</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">selPatNo</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="va">MHCAT</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">pull</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">checked5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"MH_"</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">mh_names</span>, <span class="st">" "</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Combine all into a list</span>
<span class="va">choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">checked1</span>,<span class="va">checked2</span>,<span class="va">checked3</span>,<span class="va">checked4</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">checked5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Milestones"</span>,<span class="st">"Adverse Events"</span>,<span class="st">"Concomitant Meds"</span>,<span class="st">"Labs"</span>,<span class="va">mh_names</span><span class="op">)</span> <span class="co"># ac: labels</span>

<span class="co"># build a named list &amp; Remove NULLs from the list</span>
<span class="va">choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">choices</span>,<span class="va">names</span><span class="op">)</span>
<span class="va">choices</span> <span class="op">&lt;-</span> <span class="va">choices</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">choices</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">]</span>

<span class="co"># update the checkbox group</span>
<span class="fu">updateCheckboxGroupInput</span><span class="op">(</span>
  session <span class="op">=</span> <span class="va">session</span>,
  inputId <span class="op">=</span> <span class="st">"checkGroup"</span>,
  choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">choices</span><span class="op">)</span>,
  selected <span class="op">=</span> <span class="cn">NULL</span>,
  inline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#######################################</span>
<span class="co"># Version for vlines on Visits Graph</span>
<span class="co">#######################################</span>
<span class="co"># You can only overlay Milestones, Adverse Events, and Con Meds (currently)</span>
<span class="va">choices2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">checked1</span>,<span class="va">checked2</span>,<span class="va">checked3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">names2</span> <span class="op">&lt;-</span> <span class="va">names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>

<span class="co"># Setting up colors too</span>
<span class="va">vline_eventtype_cols</span> <span class="op">&lt;-</span> <span class="va">my_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="co"># my_cols defined in utils_strObjs.R</span>
<span class="va">v_event_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">vline_eventtype_cols</span>,<span class="va">names2</span><span class="op">)</span>
<span class="va">dashes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span>
<span class="va">v_event_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">dashes</span>,<span class="va">names2</span><span class="op">)</span>

<span class="co"># build a named list &amp; Remove NULLs from the list</span>
<span class="va">choices2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">choices2</span>,<span class="va">names2</span><span class="op">)</span>
<span class="va">choices2</span> <span class="op">&lt;-</span> <span class="va">choices2</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">choices2</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">]</span>

<span class="fu">updateCheckboxGroupInput</span><span class="op">(</span>
  session <span class="op">=</span> <span class="va">session</span>,
  inputId <span class="op">=</span> <span class="st">"overlay_events"</span>,
  choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">choices2</span><span class="op">)</span>, <span class="co"># optionally convert list to array</span>
  selected <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>Notably, to add another date-oriented data frame into the mix, you (the developer) will need to add an additional <code>checkedx</code> where <code>x</code> is the next sequential number of “checked” objects. For example, if your data set is called “ADMD” where “MD” is the abbreviation for “My Data”, then you’d need to add these chunks of code into their respective positions above:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">checked6</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co"># ...</span>

<span class="kw">if</span> <span class="op">(</span><span class="st">"ADMD"</span> <span class="op">%in%</span> <span class="fu">loaded_adams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">checked6</span> <span class="op">&lt;-</span> <span class="st">"MD"</span> <span class="op">}</span>

<span class="co"># ...</span>
<span class="va">choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">checked1</span>,<span class="va">checked2</span>,<span class="va">checked3</span>,<span class="va">checked4</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">checked5</span><span class="op">)</span>,<span class="va">checked6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Milestones"</span>,<span class="st">"Adverse Events"</span>,<span class="st">"Concomitant Meds"</span>,<span class="st">"Labs"</span>,<span class="va">mh_names</span>, <span class="st">"My Data"</span><span class="op">)</span> <span class="co"># ac: labels</span>

<span class="co"># ...</span>

<span class="va">choices2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">checked1</span>,<span class="va">checked2</span>,<span class="va">checked3</span>,<span class="va">checked6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">names2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"My Data"</span><span class="op">)</span></code></pre></div>
<p>Note that adjusting the objects <code>choices2</code> &amp; <code>names2</code> are optional; only adjust if you (the developer) or subject matter experts (SMEs) deem it’s appropriate to overlay these types of events on the plot in the <code>Visits</code> tab.</p>
</div>
<div id="standardize-the-format-of-your-event-data" class="section level3">
<h3 class="hasAnchor">
<a href="#standardize-the-format-of-your-event-data" class="anchor"></a>Standardize the format of your Event data</h3>
<p>Now that the groundwork has been established, it’s time to introduce the function called <code>org_df_events()</code> which has various (well documented) arguments in the <code>mod_indvExp_fct_organizeEvent.R</code> file. This function takes a data set and manipulates it into a standard form. After being standardized, the app can (and will) combine it with other standardized event data frames as necessary.</p>
</div>
<div id="what-it-does" class="section level3">
<h3 class="hasAnchor">
<a href="#what-it-does" class="anchor"></a>What It Does</h3>
<p>Essentially, this function uses lots of shiny inputs to execute the following (among other things):</p>
<ul>
<li>Validate that the date variable(s)-of-interest exist in the data set provided</li>
<li>Selects the preferred date variable, allowing for back-ups in case the user uploads a data set where that date variable doesn’t exist</li>
<li>Toggles the data source if advanced pre-filters exist</li>
<li>Filters to a specific USUBJID and non-missing date variable</li>
<li>Evaluates an expression to display a custom event Description based on other columns in the data set</li>
<li>Produces a tidy tibble, in a standard format</li>
</ul>
<div id="an-example" class="section level4">
<h4 class="hasAnchor">
<a href="#an-example" class="anchor"></a>An Example</h4>
<p>In the example below, an Adverse Events (ADAE) is standardized using <code>org_df_events()</code>. The arguments that are pre-fixed with mi_ all come from shiny, but below they’ve been populated with examples to show the typical values they accept. That said, when implementing a new events data set, you (the developer) will need to concern yourself with the first 6 arguments, all of which are well documented on the function’s help page.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">ae_dat</span> <span class="op">&lt;-</span> <span class="fu">org_df_events</span><span class="op">(</span>
      df_name <span class="op">=</span> <span class="st">"ADAE"</span>
    , df_domain_abbr <span class="op">=</span> <span class="st">"AE"</span>
    , df_desc <span class="op">=</span> <span class="st">"Adverse Events"</span>
    , df_st_date_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AESTDT"</span>,<span class="st">"ASTDT"</span><span class="op">)</span>
    , event_desc_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,<span class="st">"AESEV"</span>,<span class="st">"AESER"</span><span class="op">)</span>
    , event_desc <span class="op">=</span> <span class="st">'paste0(AEDECOD, ", AESEV: ", AESEV, ", AESER: ", AESER)'</span>
    , mi_input_checkbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DS"</span>,<span class="st">"AE"</span><span class="op">)</span>
    , mi_input_apply_filter <span class="op">=</span> <span class="cn">FALSE</span>
    , mi_usubjid <span class="op">=</span> <span class="st">"01-701-1015"</span>
    , mi_loaded_adams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ADSL"</span>,<span class="st">"ADAE"</span><span class="op">)</span>
    , mi_datafile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="va">adsl</span>, ADAE <span class="op">=</span> <span class="va">adae</span><span class="op">)</span>
    , mi_filtered_dat <span class="op">=</span> <span class="va">filtered_dat</span>
  <span class="op">)</span></code></pre></div>
<p>What’s absolutely imperative when calling this function is that the <code>df_domain_abbr</code> matches the values for the named-list of choices passed to the <code>updateCheckGroupInput()</code> function used to update <code>input$checkGroup</code> and <code>input$overlay_events</code> discussed in <code>UI Considerations</code>.</p>
<p>Running a publicly available ADAE data set (available through <a href="https://github.com/phuse-org/TestDataFactory/tree/master/Updated/TDF_ADaM">PHUSE’s gitHub</a>) through <code>org_df_events()</code>, the output <code>ae_dat</code> might look something like the data frame below.</p>
<p><img src="figures/IndvExp/org_df_events_output.PNG" width="90%" height="90%"></p>
<p>It will always contain these variables, but the amount of rows will certainly vary. In the example output below, we see that the column “EVENTTYP” was populated with the <code>df_desc</code> argument. Later, this will be the Event type label in the <code>timevis</code> object displayed on the <code>Events</code> tab.</p>
<p>The next column is START which used the “ASTDT” column, which makes it evident that the ADAE data frame we provided in <code>mi_datafile</code> (the list of data frames uploaded by the user), didn’t have the preferred “AESTDT”, so the function selected the next best date choice: “ASTDT”. It’s important that no matter how many potential dates you provide in the <code>df_st_date_vars</code> vector, that at least one of them is a required field according to the current ADaMIG.</p>
<p>Continuing on, the END variable exists only for date-oriented data sets that would benefit from seeing a visual start and end of an event. Typically, “events” happen in one day/ instant. However, an exception to this would be medical history data where events could include medical conditions that last several days, months, or years. As such, if you (the developer) wish to implement new event data that requires showing the start AND the end of an event, follow the precedent the Medical History code establishes in the next section called <code>Build Events</code>. At the end of the day, you just want to ensure the final output mimics the output above, for reasons that will also become obvious in the next section.</p>
<p>tab_st and tab_en are just character versions of START and END which play better with DT output tables in the app.</p>
<p>Last, DECODE contains the event description (<code>event_desc</code>) you want attached to those dates. So, in this instance, the app will actually display lots of information. Above, the function weaves together content from 3 different variables using the paste function: the adverse event itself, it’s severity and seriousness. However, a single column that summarizes the event would be sufficient. If you (the developer) want to supply your own static description for an event, you should include single quotes within your double quotes. For example: <code>event_desc = "'Headache'"</code>. Doing so, will make all your adverse events take the string ‘Headache’.</p>
</div>
</div>
<div id="build-events" class="section level3">
<h3 class="hasAnchor">
<a href="#build-events" class="anchor"></a>Build Events</h3>
<p>Now that we’ve organized our data into a standard format, we need to combine the events the user selects into a singular data frame to be used in the app. This task is performed in the <code>mod_indvExp_fct_buildEvents.R</code> file. By browsing this file, you’ll witness the function just runs <code>org_df_events()</code> on all the applicable date-oriented data sets currently supported (ADMH, ADAE, ADCM, ADSL, and ADLB). The only exception to these is the ADSL and ADMH files, which require custom considerations when building the standardized data frame shown above. Therefore, if you (the developer) wish to add another date-oriented data set into the mix, add your new org_df_events() function. Then, include the name of your data frame (let’s say it’s called “md_rec”) when creating this list:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uni_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ds_rec</span>, <span class="va">ae_rec</span>, <span class="va">cm_rec</span>, <span class="va">lb_rec</span>, <span class="va">mh_rec</span>, <span class="va">md_rec</span><span class="op">)</span></code></pre></div>
<p>That’s all it takes! A few lines later, <code>uni_list</code> is rbind-ed into a single data frame (hence the need for uniformity) that <code>build_events()</code> will sort and return in the app. Once that data is in the app, it will automatically flow through to the <code>timevis</code> object on the <code>Events</code> tab or the <code>Visits</code> tab, if you (the developer) allowed it to do so.</p>
</div>
<div id="color-aesthetics" class="section level3">
<h3 class="hasAnchor">
<a href="#color-aesthetics" class="anchor"></a>Color Aesthetics</h3>
<p>The absolutely last steps is going to be just adjust a few colors schemes on both the <code>timeviz</code> object on the <code>Events</code> tab and the plot on the <code>Visits</code> tab. Why? Because consistency between the tabs will help the users quickly recognize what type of data they’re observing when the color is always consistent.</p>
<p>First, to update the colors on the <code>timeviz</code> object on the <code>Events</code> tab, find the file called <code>utils_strObjs.R</code> in the R directory. It’s there you’ll find the following code:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>,<span class="st">"Pastel2"</span><span class="op">)</span>

<span class="va">css</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"
              .nav li a.disabled {
              background-color: #aaa !important;
              color: #333 !important;
              cursor: not-allowed !important;
              border-color: #aaa !important;
              }
              
              .vis-item.DS { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.CM { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.AE { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.LB { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.MH_MH { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.MH_FDH { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,<span class="st">"; }
              .vis-item.MH_DH { background-color: "</span>,<span class="va">my_cols</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,<span class="st">"; }
              "</span><span class="op">)</span></code></pre></div>
<p>If you are adding another date-oriented data set, you’ll manually add a new color by increasing brewer.pal’s first argument by 1 (from 7 to 8 in this case). Then, you’ll add another row at the bottom. Continuing with our example, an ADMD would add a row that looks like this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="st">".vis-item.MH_DH { background-color: "</span>,my_cols[<span class="dv">8</span>],<span class="st">"; }"</span></span></code></pre></div>
<p>Similarly, for the <code>Visits</code> tab, you’ll need to add the name of the new event description to an object called <code>names2</code>, found in <code>R/mod_indvExpPatVisits_fct_plot.R</code>, assuming this type of event is appropriate to overlay on such a plot. Here, we’ve actually taken the same colors as found in the <code>my_cols</code> vector above, but tinted them slightly darker so that they are more visible on the default grey ggplot2 background. Use your discretion whether you should tint or not. When ready, add the hex digit color to the vector below called vline_eventtype_cols, in the same element position as in <code>names2</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mod_indvExpPatVisits_fct_plot</span>
<span class="va">names2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Milestones"</span>,<span class="st">"Concomitant Meds"</span>,<span class="st">"Adverse Events"</span><span class="op">)</span>
<span class="va">vline_eventtype_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#80d1ad"</span>, <span class="st">"#f5ae7d"</span>, <span class="st">"#a8bde6"</span><span class="op">)</span> <span class="co"># dark version of my_cols</span></code></pre></div>
<p>Congratulations! After completing the above steps, you should now have access to the pertinent event/dates information in the app. With any questions, please feel free to reach out to app authors/ maintainers listed in the package documentation.</p>
<p><br></p>
<p><br></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aaron Clark, Maya Gans, Robert Krajcik, Marly Gotti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
