---
title: "01 Table Generator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{01 Table Generator}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Let's walk through creating simple summary statistics using the CDISC Pilot data in conjunction with the Table Generator.

## Import Data


<br>


```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/quick_upload_then_tg.gif")
```

<br>

<br>



## Building an example table from scratch

This tutorial will walk you through calculating simple statistics for an `ADSL` variable and the `AVAL` values for a `PARAMCD` variable, calculated at a different time points in the `ADVS`.

The Table Generator tab is divided in two: the area to the left is the drag-and-drop interface used to build tables, and on the right is the real-time table output. Any uploaded data sets will appear on the left-hand side as "bins". We call them "bins" because they are just containers, showcasing contents of the data set when expanded. The `ADSL` & `ADAE` bins include all the names of all their variables, while any `BDS` data sets, like the `ADVS` & `ADLBC` bins include a list of all the `PARAMCD` values.

<br>

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/bins.gif")
```

<br>

<br>

### Age Summary Statistics

We can drag the `AGE` block from within `ADSL` and drag in the `MEAN` block from the statistical blocks to calculate summary statistics for `AGE` within the trial.

<br>

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/03-age_mean.gif")
```

### PARAMCD Summary Statistics

Similarly, we can drag in `DIABP` from `ADVS` and use the `MEAN` block to calculate summary statistics. However, we also need to select the `AVISIT` from the week dropdown in order to calculate the summary statistics of `DIABP` at a certain week.

<br>

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/04-diabp_mean.gif")
```

<br>

<br>

### Add Freq stats, re-shuffle, and deleting output

Now let's assume we forgot to add some frequency statistics for our studies age groups. In fact, we really prefer it over the quantitative statistics previously calculated on the `AGE` variable. It's no problem! We simply go back to our `ADSL` bin, select & move the `AGEGRP1` variable to the "drop zone" and pair it with a `FREQ` stat block. Recently added blocks are always added to the bottom of the list, but that's no worry, once added, you can shuffle the block around to present the output in a logical manner! To remove an undesired output, just click the `X` on the right hand side of each variable & corresponding stat block.

<br> 

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/add_freq_reshuffle_delete.gif")
```

<br>

<br> 


### Group by another Variable

We can use the `Group By` drop-down list to calculate our statistics across groups. When we select `TRT01P`, the a single column of statistics in the output is now broken down by all the planned treatment groups!

<br>

```{r,  echo=FALSE}
knitr::include_graphics("figures/tableGen/grouping.gif")
```

<br>

<br>

### Title and download table output

Now that you've created a simple table of information you needed, it's time to name it and download. Below, we insert our table title and download as CSV for further use or sharing with co-workers. Currently, the app supports CSV and HTML output formats, but PDF and RTF are coming soon!

<br>

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/title_download.gif")
```

<br>

<br> 

That's it for our example workflow when building tables from scratch. However, the table generator offers many more features, including filtering, other statistical blocks, recipes for standard analysis (STAN) tables, more export file types for output, exported R code to reproduce the table, and in-app guided help. Those topics are expanded on below!


## Other Stat blocks

Since these stat blocks provide the utmost usefulness in the Table Generator. Please use this resource as a guide when determining how to summarize your data. It's important to note that new statistical blocks are in development, so if they are not listed below, you can hover over any of the stat blocks in the app and some text will appear for a quick reference description. The statistical blocks we showcased in the demo above include the following:

- `MEAN:` Eight summary statistics are displayed. These include n, mean, standard deviation, median, Q1, Q3, Min, and Max.

- `FREQ:` Counts and percentages are displaced for all variable values that exist. Note this does not count subjects like the frequencies described below. If you'd like to count subjects, see `NESTED FREQ DSC` OR `NESTED FREQ ABC`.


The other statistical blocks we did not showcase in the demo are:

- `ANOVA:` this block can be used in conjunction with the grouping variable drop down selection to determine if means differ across groups.

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG Anova dd.PNG")
```

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG Anova.PNG")
```

<br> 

- `CHG:` like the mean block, this also calculates basic summary statistics but uses the change from baseline value rather than `AVAL`

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG CHG.PNG")
```

<br> 

- `Y FREQ:` Only applies to flag variables (ending in 'FL', like `DTHFL`) that contain 'Y' values. The output will include a subject count and percentage for **only** the 'Y' values.

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG Y FREQ.PNG")
```

<br> 

- `MAX FREQ:` This statistic only applies to variables (VAR) that have a "N" (VARN) counterpart. It's useful for variables like `AESEV` when a subjects should only be counted one time at their max VARN value. So, when paired with `AESEV` or `AESEVN`, the frequencies will reflect maximum severity of an adverse event during the trial.

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG MAX FREQ.PNG")
```

<br> 

- `NON MISSING:` A handy statistic that counts subjects who have non-missing values for a given variable. As such, it can help provide a high level measure of how many subjects had some value, as seen below with `AEDECOD`

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG NON MISSING.PNG")
```

<br> 

- `NESTED FREQ DSC:` Notice when using this stat block, you'll need to choose a variable to "nest" inside the values / levels of another. Without the nested variable selected (ie `NONE` is selected), the subject counts and percentages are displayed in descending order. Place the high level variable (like `AEBODSYS`) on the left hand side and select the more granular variable to be "nested" inside of it, like `AEDECOD`. Then the output will show all the `AEDECOD` values that exist within each `AEBODSYS`, all sorted descending. 

```{r, echo=FALSE, out.width="60%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG Nested Freq.PNG")
```


```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG Nested Freq2.PNG")
```


<br> 

- `NESTED FREQ ABC:` provides the same functionality as `NESTED FREQ DSC`, but organizes the variables and it's values in alphabetical order!

<br>


## Filtering data in the table generator

There is an entire guide called [04 Filtering](https://github.biogen.com/pages/biometrics/SEER/articles/x04_Filtering.html) dedicated to filtering in the `IDEA` application. Please reference that article, but just note that when filtering occurs on the Table Generator tab, those filters permeate all the data sets on the Table Generator tab only and will be reflected on the table output as depicted below. Also note that some mandatory filters will be applied automatically when some 'standard analysis' tables are selected so be weary of the filtering caption displayed below the table title (red brackets added for attention). Ultimately, it is the users responsibility to make sure the correct filters are applied for their table output!

<br> 

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG filtering.PNG")
```

<br>



## Standard Analysis (STAN) Tables 

There are a set of tables and listings that users may need to build frequently, due to their common inclusion in submissions to regulatory authorities. As such, the Table Generator (at the time this guide was authored) contains the following 'recipes' for commonly used tables:

<br> 

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG STAN dropdown.PNG")
```

<br> 

If the data needed to produce a certain table aren't present, the available tables listed in this dropdown selector will change. For example, if an `ADAE` is not uploaded, then all the AE tables will disappear from the above list.

When one of these tables is selected, the table generator simply compiles the needed variable and stat blocks in the correct order to generate the desired output. This can be particularly useful for tables like #41 "Blood Chemistry actual values by visit" since it would be cumbersome to manually drag in a `MEAN` block for each week and each blood chemistry parameter, as can be many. See this automation below:


<br> 

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG STAN TAB41 DD.PNG")
```


```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG STAN TAB41.PNG")
```

<br>



## Export output file types

As displayed in the demo above, you can export in an CSV or HTML file. In a future release of `IDEA`, you'll be able to prepare PDF and RTF versions of your output. However, in the meantime, you can create a PDF using a temporary work-around: first export as HTML, then download page as a PDF.

<br> 

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG export table.PNG")
```

<br>



## Export R code to reproduce table outside of app

As previously mentioned, one can reproduce any table created inside the app in an R script by downloading code using this button:

<br> 

```{r, echo=FALSE, out.width="80%", fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG reprpoduce button.PNG")
```

<br> 

Upon doing so, the R script will download to your browser and when opened in R studio, should look something like the below image. The script will help you install any packages needed for the analysis, including the `IDEA` package. If you used the CDISC Pilot data, no code will need to be amended in order to reproduce an output since that data is pre-loaded into the `IDEA` package. However, if you uploaded your data from a different source, you'll need to enter the file path to your study directory's data as a string, as seen on line 21. Note: 'path/to/study/directory/' is just a placeholder until you enter your own string. In a future release of `IDEA`, we hope to automatically fill this field for you, but security protocols prevent `IDEA` from doing that at this time. After reading in data, the R script will recall the variable and stat blocks dropped into the drop zone to recreate the output using the exact same process as in the app. From there, an R data.frame and html rendering of your table is prepared for further analysis or saving.


<br> 

```{r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG reproduce code.PNG")
```

<br>


## Need help?

Throughout all the tabs in the application, there are these little buttons (usually in the top right-hand corners) with question marks on them:

```{r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics("figures/tableGen/TG need help.PNG")
```


When clicked, they launch a real-time guide that walks the user through the major components of the currently visible screen/ tab, providing context and suggested workflow. However, if the in-app guide doesn't address your needs, consult the online documentation (that you're reading now) for the most thorough user guide. If all else fails, send the [developers](mailto:example@email.com?subject=IDEA App Question/ Request) an email with your question or request!

<br> 

```{r, echo=FALSE}
knitr::include_graphics("figures/tableGen/TG need help guide demo.gif")
```


<br> 

<br> 

<br> 

